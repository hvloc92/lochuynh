<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200..900&display=swap" rel="stylesheet">
    <title>S√°ch ƒêa Ng√¥n Ng·ªØ</title>
    <style>
        :root {
            --bg-body: #dcdcdc;
            --bg-book: #f4f1ea;
            --text-main: #1a1a1a;
            --text-sub: #555;
            --accent: #e67e22;
            --border: #d1ccc0;
        }

        /* Ch·∫ø ƒë·ªô Dark Mode */
        .dark-mode {
            --bg-body: #1a1a1b;
            --bg-book: #2c2c2e;
            --text-main: #e1e1e1;
            --text-sub: #b0b0b0;
            --accent: #f39c12;
            --border: #444;
        }

        body { 
            margin: 0; padding: 0;
            background-color: var(--bg-body);
            color: var(--text-main);
            transition: all 0.3s ease;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        .book-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-book);
            min-height: 100vh;
            padding-top: 20px;
        }

        .sentence-item {
            display: flex;
            padding: 20px 5%; /* L·ªÅ tr√°i 5% theo y√™u c·∫ßu */
            border-bottom: 1px solid var(--border);
            word-wrap: break-word; /* T·ª± ƒë·ªông xu·ªëng d√≤ng */
        }

        .text-content {
            flex: 1;
            padding-right: 15px;
        }

        .row-cn { font-family: "Noto Serif SC","Segoe UI", Tahoma, Geneva, Verdana, sans-serif; font-size: 1.8rem; font-weight: normal; margin-bottom: 20px; line-height: 1.4; }
        .row-en { font-size: 1.2rem; margin-bottom: 20px; color: var(--text-main); opacity: 0.9; }
        .row-vi { font-size: 1rem; color: var(--text-sub); font-style: italic; }
        
        .pos-tag { font-size: 0.85rem; color: var(--accent); display: block; margin-bottom: 20px; margin-top: 0px; font-weight: normal; }

        /* Ph√≠m ch·ª©c nƒÉng d·∫°ng c·ªôt icon */
        .control-sidebar {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 45px;
            align-items: center;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: 0.2s;
        }
        .btn-icon:hover { background: #eee; transform: scale(1.1); }

        /* Menu n·ªïi c·ªë ƒë·ªãnh ·ªü g√≥c d∆∞·ªõi b√™n ph·∫£i */
        .floating-menu {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
            z-index: 1000;
        }

        .settings-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
            color: #333;
            font-size: 14px;
        }

        .show-settings .settings-box { display: block; }

        .btn-main-float {
            width: 50px;
            height: 50px;
            background: #34495e;
            color: white;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            font-size: 24px;
        }

	/* Th√™m v√†o trong th·∫ª <style> */
	.pinyin-row {
    		font-size: 16px;
		font-weight: normal;
   		color: #27ae60; /* M√†u xanh l√° d·ªãu m·∫Øt */
    		display: block;
    		margin-top: 0px;
		margin-bottom: 20px;
	}


        .hidden { display: none !important; }

    </style>
</head>
<body>

<div class="book-container" id="bookContent">
    </div>

<div class="floating-menu" id="floatMenu">
    <div class="settings-box">
        <strong>‚öôÔ∏è C√†i ƒë·∫∑t</strong><hr>
        T·ªëc ƒë·ªô: <input type="range" id="rate" min="0.5" max="1.3" step="0.1" value="0.9" style="width: 100px;"><br>
        <label><input type="checkbox" id="autoNext"> T·ª± ƒë·ªông chuy·ªÉn</label><br>
	<button onclick="toggleAllPinyin()" style="width: 100%; margin-top: 10px;">üî§ ·∫®n/Hi·ªán Pinyin</button>
        <button onclick="toggleDarkMode()" style="width: 100%; margin-top: 10px;">üåô Dark Mode</button>
    </div>
    <button class="btn-main-float" onclick="document.getElementById('floatMenu').classList.toggle('show-settings')">üõ†Ô∏è</button>
</div>

<script>
const sentences = [
  {
    cn_raw: `(‰∫å)ÊàëÂßêÂßê‰∏ã‰∏™ÊúàÂ∞±Ë¶ÅÁªìÂ©ö‰∫Ü`,
    cn_split: `(‰∫å) - Êàë - ÂßêÂßê - ‰∏ã - ‰∏™ - Êúà - Â∞±Ë¶Å - ÁªìÂ©ö - ‰∫Ü`,
    cn_pos: `(num) - pron - n - adj - mw - n - adv - v - part`,
    en_raw: `(2) My elder sister is getting married next month.`,
    en_split: `(2) - My - elder - sister - is - getting - married - next - month`,
    en_pos: `(num) - pron - adj - n - v - v - adj - adj - n`,
    vi: `(Hai) Ch·ªã g√°i t√¥i th√°ng sau s·∫Øp k·∫øt h√¥n r·ªìi.`,
    pinyin: `(√àr) W«í jiƒõjiƒõ xi√† g√® yu√® ji√πy√†o ji√©h≈´n le`
  },
  {
    cn_raw: `(Â±±Êú¨È´òÂÖ¥Âú∞Âú®ÁΩë‰∏äËØª‰ø°)`,
    cn_split: `Â±±Êú¨ - È´òÂÖ¥ - Âú∞ - Âú® - ÁΩë‰∏ä - ËØª - ‰ø°`,
    cn_pos: `n - adj - part - prep - n - v - n`,
    en_raw: `(Yamamoto is happily reading a letter online)`,
    en_split: `Yamamoto - is - happily - reading - a - letter - online`,
    en_pos: `n - v - adv - v - art - n - adv`,
    vi: `(Yamamoto ƒëang vui v·∫ª ƒë·ªçc th∆∞ tr√™n m·∫°ng)`,
    pinyin: `(ShƒÅnbƒõn gƒÅox√¨ng de z√†i w«éngsh√†ng d√∫ x√¨n)`
  },
  {
    cn_raw: `Áéõ‰∏Ω:Â±±Êú¨,Êúâ‰ªÄ‰πàÂ•Ω‰∫ãÂï¶?`,
    cn_split: `Áéõ‰∏Ω - Â±±Êú¨ - Êúâ - ‰ªÄ‰πà - Â•Ω‰∫ã - Âï¶`,
    cn_pos: `n - n - v - pron - n - part`,
    en_raw: `Mary: Yamamoto, is there any good news?`,
    en_split: `Mary - Yamamoto - is - there - any - good - news`,
    en_pos: `n - n - v - adv - det - adj - n`,
    vi: `Mary: Yamamoto, c√≥ chuy·ªán g√¨ vui √†?`,
    pinyin: `M«él√¨: ShƒÅnbƒõn, y«íu sh√©nme h«éosh√¨ la?`
  },
  {
    cn_raw: `Ëøô‰πàÈ´òÂÖ¥„ÄÇ`,
    cn_split: `Ëøô‰πà - È´òÂÖ¥`,
    cn_pos: `pron - adj`,
    en_raw: `So happy.`,
    en_split: `So - happy`,
    en_pos: `adv - adj`,
    vi: `Vui th·∫ø n√†y.`,
    pinyin: `Zh√®me gƒÅox√¨ng`
  },
  {
    cn_raw: `Â±±Êú¨:ÊàëÊØç‰∫≤Êù•‰ø°‰∫Ü„ÄÇ`,
    cn_split: `Â±±Êú¨ - Êàë - ÊØç‰∫≤ - Êù• - ‰ø° - ‰∫Ü`,
    cn_pos: `n - pron - n - v - n - part`,
    en_raw: `Yamamoto: My mother sent a letter.`,
    en_split: `Yamamoto - My - mother - sent - a - letter`,
    en_pos: `n - pron - n - v - art - n`,
    vi: `Yamamoto: M·∫π t√¥i g·ª≠i th∆∞ ƒë·∫øn r·ªìi.`,
    pinyin: `ShƒÅnbƒõn: W«í m«îqƒ´n l√°i x√¨n le.`
  },
  {
    cn_raw: `Â•πÂú®‰ø°‰∏äÈ´òÂÖ¥Âú∞ËØ¥,ÊàëÂßêÂßê‰∏ã‰∏™ÊúàÂ∞±Ë¶ÅÁªìÂ©ö‰∫Ü„ÄÇ`,
    cn_split: `Â•π - Âú® - ‰ø° - ‰∏ä - È´òÂÖ¥ - Âú∞ - ËØ¥ - Êàë - ÂßêÂßê - ‰∏ã - ‰∏™ - Êúà - Â∞±Ë¶Å - ÁªìÂ©ö - ‰∫Ü`,
    cn_pos: `pron - prep - n - n - adj - part - v - pron - n - adj - mw - n - adv - v - part`,
    en_raw: `She said happily in the letter that my elder sister is getting married next month.`,
    en_split: `She - said - happily - in - the - letter - that - my - elder - sister - is - getting - married - next - month`,
    en_pos: `pron - v - adv - prep - art - n - conj - pron - adj - n - v - v - adj - adj - n`,
    vi: `B√† ·∫•y vui v·∫ª n√≥i trong th∆∞ r·∫±ng, ch·ªã g√°i t√¥i th√°ng sau s·∫Øp k·∫øt h√¥n r·ªìi.`,
    pinyin: `TƒÅ z√†i x√¨n sh√†ng gƒÅox√¨ng de shu≈ç, w«í jiƒõjiƒõ xi√† g√® yu√® ji√πy√†o ji√©h≈´n le.`
  },
  {
    cn_raw: `Áéõ‰∏Ω:‰∏äÊ¨°‰Ω†ËØ¥‰Ω†ÂßêÂßêÂàöÊâæÂà∞Â∑•‰Ωú,ÊÄé‰πàËøô‰πàÂø´Â∞±Ë¶ÅÁªìÂ©ö‰∫Ü?`,
    cn_split: `Áéõ‰∏Ω - ‰∏äÊ¨° - ‰Ω† - ËØ¥ - ‰Ω† - ÂßêÂßê - Âàö - ÊâæÂà∞ - Â∑•‰Ωú - ÊÄé‰πà - Ëøô‰πà - Âø´ - Â∞±Ë¶Å - ÁªìÂ©ö - ‰∫Ü`,
    cn_pos: `n - n - pron - v - pron - n - adv - v - n - pron - pron - adj - adv - v - part`,
    en_raw: `Mary: Last time you said your sister just found a job, how come she's getting married so soon?`,
    en_split: `Mary - Last - time - you - said - your - sister - just - found - a - job - how - come - she - is - getting - married - so - soon`,
    en_pos: `n - adj - n - pron - v - pron - n - adv - v - art - n - adv - v - pron - v - v - adj - adv - adv`,
    vi: `Mary: L·∫ßn tr∆∞·ªõc b·∫°n n√≥i ch·ªã g√°i b·∫°n v·ª´a m·ªõi t√¨m ƒë∆∞·ª£c vi·ªác l√†m, sao m√† s·∫Øp k·∫øt h√¥n nhanh th·∫ø?`,
    pinyin: `M«él√¨: Sh√†ngc√¨ n«ê shu≈ç n«ê jiƒõjiƒõ gƒÅng zh«éod√†o g≈çngzu√≤, zƒõnme zh√®me ku√†i ji√πy√†o ji√©h≈´n le?`
  },
  {
    cn_raw: `Â±±Êú¨:Â•πÊú™Â©öÂ§´‰∏çÊÑøÊÑèËÆ©Â•πÂ∑•‰Ωú‰∫Ü„ÄÇ`,
    cn_split: `Â±±Êú¨ - Â•π - Êú™Â©öÂ§´ - ‰∏ç - ÊÑøÊÑè - ËÆ© - Â•π - Â∑•‰Ωú - ‰∫Ü`,
    cn_pos: `n - pron - n - adv - v - v - pron - v - part`,
    en_raw: `Yamamoto: Her fianc√© doesn't want her to work anymore.`,
    en_split: `Yamamoto - Her - fianc√© - does - not - want - her - to - work - anymore`,
    en_pos: `n - pron - n - v - adv - v - pron - part - v - adv`,
    vi: `Yamamoto: V·ªã h√¥n phu c·ªßa ch·ªã ·∫•y kh√¥ng mu·ªën ƒë·ªÉ ch·ªã ·∫•y ƒëi l√†m n·ªØa.`,
    pinyin: `ShƒÅnbƒõn: TƒÅ w√®ih≈´nf≈´ b√π yu√†ny√¨ r√†ng tƒÅ g≈çngzu√≤ le.`
  },
  {
    cn_raw: `Áéõ‰∏Ω:Ëøô‰πàËØ¥,ÁªìÂ©ö‰ª•ÂêéÂ•πÂ∞±‰∏çÂ∑•‰Ωú‰∫Ü?`,
    cn_split: `Áéõ‰∏Ω - Ëøô‰πà - ËØ¥ - ÁªìÂ©ö - ‰ª•Âêé - Â•π - Â∞± - ‰∏ç - Â∑•‰Ωú - ‰∫Ü`,
    cn_pos: `n - pron - v - v - n - pron - adv - adv - v - part`,
    en_raw: `Mary: So, she won't work after getting married?`,
    en_split: `Mary - So - she - will - not - work - after - getting - married`,
    en_pos: `n - adv - pron - v - adv - v - prep - v - adj`,
    vi: `Mary: N√≥i nh∆∞ v·∫≠y, sau khi k·∫øt h√¥n ch·ªã ·∫•y s·∫Ω kh√¥ng ƒëi l√†m n·ªØa sao?`,
    pinyin: `M«él√¨: Zh√®me shu≈ç, ji√©h≈´n y«êh√≤u tƒÅ ji√π b√π g≈çngzu√≤ le?`
  },
  {
    cn_raw: `Â±±Êú¨:ÂØπ„ÄÇ`,
    cn_split: `Â±±Êú¨ - ÂØπ`,
    cn_pos: `n - adj`,
    en_raw: `Yamamoto: Right.`,
    en_split: `Yamamoto - Right`,
    en_pos: `n - adj`,
    vi: `Yamamoto: ƒê√∫ng v·∫≠y.`,
    pinyin: `ShƒÅnbƒõn: Du√¨.`
  },
  {
    cn_raw: `Áéõ‰∏Ω:Â∞ÜÊù•‰Ω†‰πü‰ºöËøôÊ†∑Âêó?`,
    cn_split: `Áéõ‰∏Ω - Â∞ÜÊù• - ‰Ω† - ‰πü - ‰ºö - ËøôÊ†∑ - Âêó`,
    cn_pos: `n - n - pron - adv - v - pron - part`,
    en_raw: `Mary: Will you be like this in the future too?`,
    en_split: `Mary - Will - you - be - like - this - in - the - future - too`,
    en_pos: `n - v - pron - v - prep - pron - prep - art - n - adv`,
    vi: `Mary: T∆∞∆°ng lai b·∫°n c≈©ng s·∫Ω nh∆∞ th·∫ø n√†y sao?`,
    pinyin: `M«él√¨: JiƒÅngl√°i n«ê yƒõ hu√¨ zh√®y√†ng ma?`
  },
  {
    cn_raw: `Áªì‰∫ÜÂ©öÂ∞±‰∏çÂ∑•‰Ωú‰∫ÜÂêó?`,
    cn_split: `Áªì - ‰∫Ü - Â©ö - Â∞± - ‰∏ç - Â∑•‰Ωú - ‰∫Ü - Âêó`,
    cn_pos: `v - part - n - adv - adv - v - part - part`,
    en_raw: `Won't you work after getting married?`,
    en_split: `Will - you - not - work - after - getting - married`,
    en_pos: `v - pron - adv - v - prep - v - adj`,
    vi: `K·∫øt h√¥n xong l√† kh√¥ng ƒëi l√†m n·ªØa √†?`,
    pinyin: `Ji√©le h≈´n ji√π b√π g≈çngzu√≤ le ma?`
  },
  {
    cn_raw: `Â±±Êú¨:‰∏ç„ÄÇ`,
    cn_split: `Â±±Êú¨ - ‰∏ç`,
    cn_pos: `n - adv`,
    en_raw: `Yamamoto: No.`,
    en_split: `Yamamoto - No`,
    en_pos: `n - adv`,
    vi: `Yamamoto: Kh√¥ng.`,
    pinyin: `ShƒÅnbƒõn: B√π.`
  },
  {
    cn_raw: `Â±±Êú¨:ÊàëÂñúÊ¨¢Â∑•‰Ωú„ÄÇ`,
    cn_split: `Â±±Êú¨ - Êàë - ÂñúÊ¨¢ - Â∑•‰Ωú`,
    cn_pos: `n - pron - v - v`,
    en_raw: `Yamamoto: I like working.`,
    en_split: `Yamamoto - I - like - working`,
    en_pos: `n - pron - v - v`,
    vi: `Yamamoto: T√¥i th√≠ch l√†m vi·ªác.`,
    pinyin: `ShƒÅnbƒõn: W«í x«êhuƒÅn g≈çngzu√≤.`
  },
  {
    cn_raw: `Ë¶ÅÊòØ‰∏çËÆ©ÊàëÂ∑•‰Ωú,ÊàëÂ∞±‰∏çÁªìÂ©ö„ÄÇ`,
    cn_split: `Ë¶ÅÊòØ - ‰∏ç - ËÆ© - Êàë - Â∑•‰Ωú - Êàë - Â∞± - ‰∏ç - ÁªìÂ©ö`,
    cn_pos: `conj - adv - v - pron - v - pron - adv - adv - v`,
    en_raw: `If I'm not allowed to work, I won't get married.`,
    en_split: `If - I - am - not - allowed - to - work - I - will - not - get - married`,
    en_pos: `conj - pron - v - adv - v - part - v - pron - v - adv - v - adj`,
    vi: `N·∫øu nh∆∞ kh√¥ng ƒë·ªÉ t√¥i l√†m vi·ªác, t√¥i s·∫Ω kh√¥ng k·∫øt h√¥n.`,
    pinyin: `Y√†oshi b√π r√†ng w«í g≈çngzu√≤, w«í ji√π b√π ji√©h≈´n.`
  }
];
// C·∫≠p nh·∫≠t h√†m render ƒë·ªÉ truy·ªÅn d·ªØ li·ªáu an to√†n h∆°n
function renderBook() {
    const container = document.getElementById('bookContent');
    sentences.forEach((s, i) => {
        const item = document.createElement('div');
        item.className = 'sentence-item';
        item.innerHTML = `
            <div class="text-content">
                <div class="row-cn">
                    <span id="cn-txt-${i}">${s.cn_raw}</span>
                </div>
                <div id="cn-pos-${i}" class="pos-tag hidden">${s.cn_pos}</div>
                <div id="pinyin-${i}" class="pinyin-row hidden">${s.pinyin || ''}</div>
                <div class="row-en">
                    <span id="en-txt-${i}">${s.en_raw}</span>
                </div>
                <div id="en-pos-${i}" class="pos-tag hidden">${s.en_pos}</div>
                <div class="row-vi">${s.vi}</div>
            </div>
            <div class="control-sidebar">
                <button class="btn-icon" onclick="playSpeech(${i}, 'cn')">‚ôò</button>
                <button class="btn-icon" onclick="toggleMode(${i}, 'cn')">‚ôî</button>
                <button class="btn-icon" onclick="playSpeech(${i}, 'en')">‚ôñ</button>
                <button class="btn-icon" onclick="toggleMode(${i}, 'en')">‚ôï</button>
            </div>
        `;
        container.appendChild(item);
    });
}
// H√†m ph√°t √¢m m·ªõi: L·∫•y d·ªØ li·ªáu tr·ª±c ti·∫øp t·ª´ m·∫£ng thay v√¨ truy·ªÅn chu·ªói qua HTML
// H√†m ph√°t √¢m: T·ª± ƒë·ªông duy tr√¨ ng√¥n ng·ªØ ƒëang ch·ªçn
function playSpeech(index, langType) {
    // 1. D·ª´ng m·ªçi √¢m thanh ƒëang ph√°t ƒë·ªÉ tr√°nh ch·ªìng ch√©o
    window.speechSynthesis.cancel(); 

    let textToRead = "";
    let langCode = "";

    // 2. X√°c ƒë·ªãnh n·ªôi dung v√† m√£ ng√¥n ng·ªØ d·ª±a tr√™n l·ª±a ch·ªçn c·ªßa ng∆∞·ªùi d√πng
    if (langType === 'cn') {
        textToRead = sentences[index].cn_raw;
        langCode = 'zh-CN';
    } else {
        textToRead = sentences[index].en_raw;
        langCode = 'en-US';
    }

    const msg = new SpeechSynthesisUtterance();
    msg.text = textToRead;
    msg.lang = langCode;
    msg.rate = document.getElementById('rate').value;
    
    // 3. Hi·ªáu ·ª©ng Highlight: T√¥ m√†u c√¢u ƒëang ƒë·ªçc ƒë·ªÉ d·ªÖ theo d√µi
    const allItems = document.getElementsByClassName('sentence-item');
    // X√≥a m√†u c·ªßa t·∫•t c·∫£ c√°c c√¢u kh√°c
    Array.from(allItems).forEach(item => item.style.backgroundColor = "transparent");
    // T√¥ m√†u v√†ng nh·∫°t cho c√¢u hi·ªán t·∫°i
    allItems[index].style.backgroundColor = "rgba(230, 126, 34, 0.1)";

    // 4. X·ª≠ l√Ω khi k·∫øt th√∫c c√¢u
    msg.onend = () => {
        const isAuto = document.getElementById('autoNext').checked;
        if (isAuto && index < sentences.length - 1) {
            setTimeout(() => {
                // QUAN TR·ªåNG: Truy·ªÅn ƒë√∫ng langType hi·ªán t·∫°i v√†o l·∫ßn g·ªçi ti·∫øp theo
                playSpeech(index + 1, langType); 
                
                // T·ª± ƒë·ªông cu·ªôn m√†n h√¨nh ƒë·∫øn c√¢u ti·∫øp theo
                allItems[index + 1].scrollIntoView({
                    behavior: "smooth", 
                    block: "center"
                });
            }, 500); // Ngh·ªâ 0.5 gi√¢y gi·ªØa c√°c c√¢u ƒë·ªÉ ng∆∞·ªùi d√πng k·ªãp ng·∫•m
        }
    };

    window.speechSynthesis.speak(msg);
}
function toggleMode(index, lang) {
    const txtSpan = document.getElementById(`${lang}-txt-${index}`);
    const posSpan = document.getElementById(`${lang}-pos-${index}`);
    const isOriginal = txtSpan.innerText === sentences[index][`${lang}_raw`];

    txtSpan.innerText = isOriginal ? sentences[index][`${lang}_split`] : sentences[index][`${lang}_raw`];
    posSpan.classList.toggle('hidden');
}

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
}

function toggleAllPinyin() {
    // 1. L·∫•y t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ c√≥ class l√† pinyin-row
    const pinyinElements = document.getElementsByClassName('pinyin-row');
    
    // 2. Ki·ªÉm tra n·∫øu kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ n√†o (b√°o l·ªói ra Console ƒë·ªÉ ki·ªÉm tra)
    if (pinyinElements.length === 0) {
        console.error("Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ n√†o c√≥ class 'pinyin-row'");
        return;
    }

    // 3. Duy·ªát qua t·ª´ng ph·∫ßn t·ª≠ v√† b·∫≠t/t·∫Øt class 'hidden'
    for (let i = 0; i < pinyinElements.length; i++) {
        pinyinElements[i].classList.toggle('hidden');
    }
}

function speak(text, lang, index) {
    window.speechSynthesis.cancel();
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = lang;
    msg.rate = document.getElementById('rate').value;

    msg.onend = () => {
        if (document.getElementById('autoNext').checked && index < sentences.length - 1) {
            setTimeout(() => {
                speak(sentences[index + 1].cn_raw, 'zh-CN', index + 1);
                document.getElementsByClassName('sentence-item')[index+1].scrollIntoView({behavior: "smooth", block: "center"});
            }, 1200);
        }
    };
    window.speechSynthesis.speak(msg);
}

renderBook();
</script>
</body>
</html>