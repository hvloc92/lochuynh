<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S√°ch ƒêa Ng√¥n Ng·ªØ</title>
    <style>
        :root {
            --bg-body: #dcdcdc;
            --bg-book: #f4f1ea;
            --text-main: #1a1a1a;
            --text-sub: #555;
            --accent: #e67e22;
            --border: #d1ccc0;
        }

        /* Ch·∫ø ƒë·ªô Dark Mode */
        .dark-mode {
            --bg-body: #1a1a1b;
            --bg-book: #2c2c2e;
            --text-main: #e1e1e1;
            --text-sub: #b0b0b0;
            --accent: #f39c12;
            --border: #444;
        }

        body { 
            margin: 0; padding: 0;
            background-color: var(--bg-body);
            color: var(--text-main);
            transition: all 0.3s ease;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        }

        .book-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-book);
            min-height: 100vh;
            padding-top: 20px;
        }

        .sentence-item {
            display: flex;
            padding: 20px 5%; /* L·ªÅ tr√°i 5% theo y√™u c·∫ßu */
            border-bottom: 1px solid var(--border);
            word-wrap: break-word; /* T·ª± ƒë·ªông xu·ªëng d√≤ng */
        }

        .text-content {
            flex: 1;
            padding-right: 15px;
        }

        .row-cn { font-size: 1.8rem; font-weight: normal; margin-bottom: 8px; line-height: 1.4; }
        .row-en { font-size: 1.2rem; margin-bottom: 5px; color: var(--text-main); opacity: 0.9; }
        .row-vi { font-size: 1rem; color: var(--text-sub); font-style: italic; }
        
        .pos-tag { font-size: 0.85rem; color: var(--accent); display: block; margin-top: 4px; font-weight: normal; }

        /* Ph√≠m ch·ª©c nƒÉng d·∫°ng c·ªôt icon */
        .control-sidebar {
            display: flex;
            flex-direction: column;
            gap: 8px;
            width: 45px;
            align-items: center;
        }

        .btn-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: 0.2s;
        }
        .btn-icon:hover { background: #eee; transform: scale(1.1); }

        /* Menu n·ªïi c·ªë ƒë·ªãnh ·ªü g√≥c d∆∞·ªõi b√™n ph·∫£i */
        .floating-menu {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 10px;
            z-index: 1000;
        }

        .settings-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
            color: #333;
            font-size: 14px;
        }

        .show-settings .settings-box { display: block; }

        .btn-main-float {
            width: 50px;
            height: 50px;
            background: #34495e;
            color: white;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            font-size: 24px;
        }

	/* Th√™m v√†o trong th·∫ª <style> */
	.pinyin-row {
    		font-size: 16px;
		font-weight: normal;
   		color: #27ae60; /* M√†u xanh l√° d·ªãu m·∫Øt */
    		display: block;
    		margin-top: 2px;
	}


        .hidden { display: none !important; }

    </style>
</head>
<body>

<div class="book-container" id="bookContent">
    </div>

<div class="floating-menu" id="floatMenu">
    <div class="settings-box">
        <strong>‚öôÔ∏è C√†i ƒë·∫∑t</strong><hr>
        T·ªëc ƒë·ªô: <input type="range" id="rate" min="0.5" max="1.3" step="0.1" value="0.9" style="width: 100px;"><br>
        <label><input type="checkbox" id="autoNext"> T·ª± ƒë·ªông chuy·ªÉn</label><br>
	<button onclick="toggleAllPinyin()" style="width: 100%; margin-top: 10px;">üî§ ·∫®n/Hi·ªán Pinyin</button>
        <button onclick="toggleDarkMode()" style="width: 100%; margin-top: 10px;">üåô Dark Mode</button>
    </div>
    <button class="btn-main-float" onclick="document.getElementById('floatMenu').classList.toggle('show-settings')">üõ†Ô∏è</button>
</div>

<script>
const sentences = [
  {
    cn_raw: `(‰∫å)ÊàëÊØî‰Ω†Êõ¥ÂñúÊ¨¢Èü≥‰πê`,
    cn_split: `(‰∫å)  -  Êàë  -  ÊØî  -  ‰Ω†  -  Êõ¥  -  ÂñúÊ¨¢  -  Èü≥‰πê`,
    cn_pos: `(num)  -  pron  -  prep  -  pron  -  adv  -  v  -  n`,
    en_raw: `(2) I like music even more than you.`,
    en_split: `(2)  -  I  -  like  -  music  -  even  -  more  -  than  -  you`,
    en_pos: `(num)  -  pron  -  v  -  n  -  adv  -  adv  -  prep  -  pron`,
    vi: `(Hai) T√¥i th√≠ch √¢m nh·∫°c h∆°n b·∫°n.`,
    pinyin: `(√àr) W«í b«ê n«ê g√®ng x«êhuƒÅn yƒ´nyu√®`
  },
  {
    cn_raw: `(ÊûóËÄÅÂ∏àÂíåÁéãËÄÅÂ∏àÂú®Ë∞àÈü≥‰πê)`,
    cn_split: `Êûó  -  ËÄÅÂ∏à  -  Âíå  -  Áéã  -  ËÄÅÂ∏à  -  Âú®  -  Ë∞à  -  Èü≥‰πê`,
    cn_pos: `n  -  n  -  conj  -  n  -  n  -  adv  -  v  -  n`,
    en_raw: `(Teacher Lin and Teacher Wang are talking about music)`,
    en_split: `Teacher  -  Lin  -  and  -  Teacher  -  Wang  -  are  -  talking  -  about  -  music`,
    en_pos: `n  -  n  -  conj  -  n  -  n  -  v  -  v  -  prep  -  n`,
    vi: `(Th·∫ßy L√¢m v√† th·∫ßy V∆∞∆°ng ƒëang b√†n v·ªÅ √¢m nh·∫°c)`,
    pinyin: `(L√≠n l«éoshƒ´ h√© W√°ng l«éoshƒ´ z√†i t√°n yƒ´nyu√®)`
  },
  {
    cn_raw: `ÊûóËÄÅÂ∏à:ÁéãËÄÅÂ∏à,‰Ω†ÂñúÊ¨¢Èü≥‰πêÂêó?`,
    cn_split: `Êûó  -  ËÄÅÂ∏à  -  Áéã  -  ËÄÅÂ∏à  -  ‰Ω†  -  ÂñúÊ¨¢  -  Èü≥‰πê  -  Âêó`,
    cn_pos: `n  -  n  -  n  -  n  -  pron  -  v  -  n  -  part`,
    en_raw: `Teacher Lin: Teacher Wang, do you like music?`,
    en_split: `Teacher  -  Lin  -  Teacher  -  Wang  -  do  -  you  -  like  -  music`,
    en_pos: `n  -  n  -  n  -  n  -  v  -  pron  -  v  -  n`,
    vi: `Th·∫ßy L√¢m: Th·∫ßy V∆∞∆°ng, th·∫ßy c√≥ th√≠ch √¢m nh·∫°c kh√¥ng?`,
    pinyin: `L√≠n l«éoshƒ´: W√°ng l«éoshƒ´, n«ê x«êhuƒÅn yƒ´nyu√® ma?`
  },
  {
    cn_raw: `ÁéãËÄÅÂ∏à:ÂñúÊ¨¢Âïä!`,
    cn_split: `Áéã  -  ËÄÅÂ∏à  -  ÂñúÊ¨¢  -  Âïä`,
    cn_pos: `n  -  n  -  v  -  part`,
    en_raw: `Teacher Wang: I do!`,
    en_split: `Teacher  -  Wang  -  I  -  do`,
    en_pos: `n  -  n  -  pron  -  v`,
    vi: `Th·∫ßy V∆∞∆°ng: Th√≠ch ch·ª©!`,
    pinyin: `W√°ng l«éoshƒ´: X«êhuƒÅn a!`
  },
  {
    cn_raw: `ÊàëÊòØ‰∏™Èü≥‰πêËø∑,ÂÖâCDÂ∞±ÊúâÂ•ΩÂá†ÁôæÂº†Âë¢„ÄÇ`,
    cn_split: `Êàë  -  ÊòØ  -  ‰∏™  -  Èü≥‰πê  -  Ëø∑  -  ÂÖâ  -  CD  -  Â∞±  -  Êúâ  -  Â•Ω  -  Âá†  -  Áôæ  -  Âº†  -  Âë¢`,
    cn_pos: `pron  -  v  -  mw  -  n  -  n  -  adv  -  n  -  adv  -  v  -  adv  -  num  -  num  -  mw  -  part`,
    en_raw: `I am a music fan, I have several hundred CDs alone.`,
    en_split: `I  -  am  -  a  -  music  -  fan  -  I  -  have  -  several  -  hundred  -  CDs  -  alone`,
    en_pos: `pron  -  v  -  art  -  n  -  n  -  pron  -  v  -  adj  -  num  -  n  -  adv`,
    vi: `T√¥i l√† m·ªôt ng∆∞·ªùi m√™ nh·∫°c, ch·ªâ ri√™ng CD ƒë√£ c√≥ m·∫•y trƒÉm chi·∫øc r·ªìi.`,
    pinyin: `W«í sh√¨ g√® yƒ´nyu√® m√≠, guƒÅng CD ji√π y«íu h«éoj«ê b«éi zhƒÅng ne.`
  },
  {
    cn_raw: `ÊûóËÄÅÂ∏à:Êàë‰πüÂæàÂñúÊ¨¢Èü≥‰πê,‰πüËÆ∏ÊØî‰Ω†Êõ¥ÂñúÊ¨¢„ÄÇ`,
    cn_split: `Êûó  -  ËÄÅÂ∏à  -  Êàë  -  ‰πü  -  Âæà  -  ÂñúÊ¨¢  -  Èü≥‰πê  -  ‰πüËÆ∏  -  ÊØî  -  ‰Ω†  -  Êõ¥  -  ÂñúÊ¨¢`,
    cn_pos: `n  -  n  -  pron  -  adv  -  adv  -  v  -  n  -  adv  -  prep  -  pron  -  adv  -  v`,
    en_raw: `Teacher Lin: I also like music very much, maybe even more than you.`,
    en_split: `Teacher  -  Lin  -  I  -  also  -  like  -  music  -  very  -  much  -  maybe  -  even  -  more  -  than  -  you`,
    en_pos: `n  -  n  -  pron  -  adv  -  v  -  n  -  adv  -  adv  -  adv  -  adv  -  prep  -  pron`,
    vi: `Th·∫ßy L√¢m: T√¥i c≈©ng r·∫•t th√≠ch √¢m nh·∫°c, c√≥ l·∫Ω c√≤n th√≠ch h∆°n c·∫£ th·∫ßy.`,
    pinyin: `L√≠n l«éoshƒ´: W«í yƒõ hƒõn x«êhuƒÅn yƒ´nyu√®, yƒõx«î b«ê n«ê g√®ng x«êhuƒÅn.`
  },
  {
    cn_raw: `‰Ω†ÂñúÊ¨¢Âè§ÂÖ∏Èü≥‰πêËøòÊòØÂñúÊ¨¢Áé∞‰ª£Èü≥‰πê?`,
    cn_split: `‰Ω†  -  ÂñúÊ¨¢  -  Âè§ÂÖ∏  -  Èü≥‰πê  -  ËøòÊòØ  -  ÂñúÊ¨¢  -  Áé∞‰ª£  -  Èü≥‰πê`,
    cn_pos: `pron  -  v  -  adj  -  n  -  conj  -  v  -  adj  -  n`,
    en_raw: `Do you like classical music or modern music?`,
    en_split: `Do  -  you  -  like  -  classical  -  music  -  or  -  modern  -  music`,
    en_pos: `v  -  pron  -  v  -  adj  -  n  -  conj  -  adj  -  n`,
    vi: `Th·∫ßy th√≠ch nh·∫°c c·ªï ƒëi·ªÉn hay l√† th√≠ch nh·∫°c hi·ªán ƒë·∫°i?`,
    pinyin: `N«ê x«êhuƒÅn g«îdi«én yƒ´nyu√® h√°ish√¨ x«êhuƒÅn xi√†nd√†i yƒ´nyu√®?`
  },
  {
    cn_raw: `ÁéãËÄÅÂ∏à:ÊàëÂñúÊ¨¢Âè§ÂÖ∏Èü≥‰πê„ÄÇ`,
    cn_split: `Áéã  -  ËÄÅÂ∏à  -  Êàë  -  ÂñúÊ¨¢  -  Âè§ÂÖ∏  -  Èü≥‰πê`,
    cn_pos: `n  -  n  -  pron  -  v  -  adj  -  n`,
    en_raw: `Teacher Wang: I like classical music.`,
    en_split: `Teacher  -  Wang  -  I  -  like  -  classical  -  music`,
    en_pos: `n  -  n  -  pron  -  v  -  adj  -  n`,
    vi: `Th·∫ßy V∆∞∆°ng: T√¥i th√≠ch nh·∫°c c·ªï ƒëi·ªÉn.`,
    pinyin: `W√°ng l«éoshƒ´: W«í x«êhuƒÅn g«îdi«én yƒ´nyu√®.`
  },
  {
    cn_raw: `ÂñúÊ¨¢Âê¨‰∏ñÁïåÂêçÊõ≤,ËøòÂñúÊ¨¢Âê¨Ê∞ëÊ≠å„ÄÇ`,
    cn_split: `ÂñúÊ¨¢  -  Âê¨  -  ‰∏ñÁïå  -  ÂêçÊõ≤  -  Ëøò  -  ÂñúÊ¨¢  -  Âê¨  -  Ê∞ëÊ≠å`,
    cn_pos: `v  -  v  -  n  -  n  -  adv  -  v  -  v  -  n`,
    en_raw: `I like listening to world  -  famous songs and folk songs.`,
    en_split: `I  -  like  -  listening  -  to  -  world  -  famous  -  songs  -  and  -  folk  -  songs`,
    en_pos: `pron  -  v  -  v  -  prep  -  adj  -  n  -  conj  -  n  -  n`,
    vi: `Th√≠ch nghe c√°c b·∫£n nh·∫°c n·ªïi ti·∫øng th·∫ø gi·ªõi, c√≤n th√≠ch nghe d√¢n ca n·ªØa.`,
    pinyin: `X«êhuƒÅn tƒ´ng sh√¨ji√® m√≠ngq«î, h√°i x«êhuƒÅn tƒ´ng m√≠ngƒì.`
  },
  {
    cn_raw: `ÊûóËÄÅÂ∏à:Êàë‰πüÂñúÊ¨¢Âè§ÂÖ∏Èü≥‰πê„ÄÇ`,
    cn_split: `Êûó  -  ËÄÅÂ∏à  -  Êàë  -  ‰πü  -  ÂñúÊ¨¢  -  Âè§ÂÖ∏  -  Èü≥‰πê`,
    cn_pos: `n  -  n  -  pron  -  adv  -  v  -  adj  -  n`,
    en_raw: `Teacher Lin: I also like classical music.`,
    en_split: `Teacher  -  Lin  -  I  -  also  -  like  -  classical  -  music`,
    en_pos: `n  -  n  -  pron  -  adv  -  v  -  adj  -  n`,
    vi: `Th·∫ßy L√¢m: T√¥i c≈©ng th√≠ch nh·∫°c c·ªï ƒëi·ªÉn.`,
    pinyin: `L√≠n l«éoshƒ´: W«í yƒõ x«êhuƒÅn g«îdi«én yƒ´nyu√®.`
  },
  {
    cn_raw: `‰Ω†ÂñúÊ¨¢ÊµÅË°åÊ≠åÊõ≤Âêó?`,
    cn_split: `‰Ω†  -  ÂñúÊ¨¢  -  ÊµÅË°å  -  Ê≠åÊõ≤  -  Âêó`,
    cn_pos: `pron  -  v  -  adj  -  n  -  part`,
    en_raw: `Do you like pop songs?`,
    en_split: `Do  -  you  -  like  -  pop  -  songs`,
    en_pos: `v  -  pron  -  v  -  adj  -  n`,
    vi: `Th·∫ßy c√≥ th√≠ch c√°c b√†i h√°t th·ªãnh h√†nh kh√¥ng?`,
    pinyin: `N«ê x«êhuƒÅn li√∫x√≠ng gƒìq«î ma?`
  },
  {
    cn_raw: `ÁéãËÄÅÂ∏à:ÊÄé‰πàËØ¥Âë¢?`,
    cn_split: `Áéã  -  ËÄÅÂ∏à  -  ÊÄé‰πà  -  ËØ¥  -  Âë¢`,
    cn_pos: `n  -  n  -  pron  -  v  -  part`,
    en_raw: `Teacher Wang: How should I say it?`,
    en_split: `Teacher  -  Wang  -  How  -  should  -  I  -  say  -  it`,
    en_pos: `n  -  n  -  adv  -  v  -  pron  -  v  -  pron`,
    vi: `Th·∫ßy V∆∞∆°ng: N√≥i th·∫ø n√†o nh·ªâ?`,
    pinyin: `W√°ng l«éoshƒ´: Zƒõnme shu≈ç ne?`
  },
  {
    cn_raw: `ÂèØËÉΩÊ≤°Êúâ‰Ω†‰ª¨Âπ¥ËΩª‰∫∫ÈÇ£‰πàÂñúÊ¨¢„ÄÇ`,
    cn_split: `ÂèØËÉΩ  -  Ê≤°Êúâ  -  ‰Ω†‰ª¨  -  Âπ¥ËΩª  -  ‰∫∫  -  ÈÇ£‰πà  -  ÂñúÊ¨¢`,
    cn_pos: `adv  -  v  -  pron  -  adj  -  n  -  adv  -  v`,
    en_raw: `Maybe I don't like them as much as you young people do.`,
    en_split: `Maybe  -  I  -  don't  -  like  -  them  -  as  -  much  -  as  -  you  -  young  -  people  -  do`,
    en_pos: `adv  -  pron  -  v  -  v  -  pron  -  adv  -  adv  -  prep  -  pron  -  adj  -  n  -  v`,
    vi: `C√≥ l·∫Ω kh√¥ng th√≠ch b·∫±ng nh·ªØng ng∆∞·ªùi tr·∫ª c√°c th·∫ßy.`,
    pinyin: `Kƒõn√©ng m√©iy«íu n«êmen ni√°nqƒ´ng r√©n n√†me x«êhuƒÅn.`
  },
  {
    cn_raw: `ÊàëËßâÂæóÊµÅË°åÊ≠åÊõ≤ÏùòÊ≠åËØçÊ≤°ÊúâÊ∞ëÊ≠åÂÜôÂæóÂ•Ω„ÄÇ`,
    cn_split: `Êàë  -  ËßâÂæó  -  ÊµÅË°å  -  Ê≠åÊõ≤  -  ÁöÑ  -  Ê≠åËØç  -  Ê≤°Êúâ  -  Ê∞ëÊ≠å  -  ÂÜô  -  Âæó  -  Â•Ω`,
    cn_pos: `pron  -  v  -  adj  -  n  -  part  -  n  -  v  -  n  -  v  -  part  -  adj`,
    en_raw: `I think the lyrics of pop songs are not written as well as folk songs.`,
    en_split: `I  -  think  -  the  -  lyrics  -  of  -  pop  -  songs  -  are  -  not  -  written  -  as  -  well  -  as  -  folk  -  songs`,
    en_pos: `pron  -  v  -  art  -  n  -  prep  -  adj  -  n  -  v  -  adv  -  v  -  adv  -  adv  -  prep  -  n  -  n`,
    vi: `T√¥i c·∫£m th·∫•y l·ªùi b√†i h√°t th·ªãnh h√†nh vi·∫øt kh√¥ng hay b·∫±ng d√¢n ca.`,
    pinyin: `W«í ju√©d√© li√∫x√≠ng gƒìq«î de gƒìc√≠ m√©iy«íu m√≠ngƒì xiƒõ de h«éo.`
  },
  {
    cn_raw: `ÊûóËÄÅÂ∏à:Êúâ‰∫õÊµÅË°åÊ≠åÊõ≤ÁöÑÊ≠åËØçÂÜôÂæóËøòÊòØ‰∏çÈîôÁöÑ„ÄÇ`,
    cn_split: `Êûó  -  ËÄÅÂ∏à  -  Êúâ‰∫õ  -  ÊµÅË°å  -  Ê≠åÊõ≤  -  ÁöÑ  -  Ê≠åËØç  -  ÂÜô  -  Âæó  -  ËøòÊòØ  -  ‰∏çÈîô  -  ÁöÑ`,
    cn_pos: `n  -  n  -  pron  -  adj  -  n  -  part  -  n  -  v  -  part  -  adv  -  adj  -  part`,
    en_raw: `Teacher Lin: The lyrics of some pop songs are still quite good.`,
    en_split: `Teacher  -  Lin  -  The  -  lyrics  -  of  -  some  -  pop  -  songs  -  are  -  still  -  quite  -  good`,
    en_pos: `n  -  n  -  art  -  n  -  prep  -  det  -  adj  -  n  -  v  -  adv  -  adv  -  adj`,
    vi: `Th·∫ßy L√¢m: L·ªùi c·ªßa m·ªôt s·ªë b√†i h√°t th·ªãnh h√†nh vi·∫øt c≈©ng kh√° t·ªët ƒë·∫•y ch·ª©.`,
    pinyin: `L√≠n l«éoshƒ´: Y«íuxiƒì li√∫x√≠ng gƒìq«î de gƒìc√≠ xiƒõ de h√°ish√¨ b√πcu√≤ de.`
  },
  {
    cn_raw: `ÁéãËÄÅÂ∏à:ÂèØÊòØ,ÊàëËøòÊòØËßâÂæóÊ∞ëÊ≠åÁöÑÊ≠åËØçÂ•Ω„ÄÇ`,
    cn_split: `Áéã  -  ËÄÅÂ∏à  -  ÂèØÊòØ  -  Êàë  -  ËøòÊòØ  -  ËßâÂæó  -  Ê∞ëÊ≠å  -  ÁöÑ  -  Ê≠åËØç  -  Â•Ω`,
    cn_pos: `n  -  n  -  conj  -  pron  -  adv  -  v  -  n  -  part  -  n  -  adj`,
    en_raw: `Teacher Wang: But, I still think the lyrics of folk songs are better.`,
    en_split: `Teacher  -  Wang  -  But  -  I  -  still  -  think  -  the  -  lyrics  -  of  -  folk  -  songs  -  are  -  better`,
    en_pos: `n  -  n  -  conj  -  pron  -  adv  -  v  -  art  -  n  -  prep  -  n  -  n  -  v  -  adj`,
    vi: `Th·∫ßy V∆∞∆°ng: Nh∆∞ng m√†, t√¥i v·∫´n th·∫•y l·ªùi c·ªßa d√¢n ca hay h∆°n.`,
    pinyin: `W√°ng l«éoshƒ´: Kƒõsh√¨, w«í h√°ish√¨ ju√©d√© m√≠ngƒì de gƒìc√≠ h«éo.`
  },
  {
    cn_raw: `‰Ω†Âê¨Âí±‰ª¨ÁöÑÊ∞ëÊ≠å,‚ÄúÂú®ÈÇ£ÈÅ•ËøúÁöÑÂú∞Êñπ‚Äù,ÂÜôÂæóÂ§öÂ•Ω!`,
    cn_split: `‰Ω†  -  Âê¨  -  Âí±‰ª¨  -  ÁöÑ  -  Ê∞ëÊ≠å  -  Âú®  -  ÈÇ£  -  ÈÅ•Ëøú  -  ÁöÑ  -  Âú∞Êñπ  -  ÂÜô  -  Âæó  -  Â§ö  -  Â•Ω`,
    cn_pos: `pron  -  v  -  pron  -  part  -  n  -  prep  -  pron  -  adj  -  part  -  n  -  v  -  part  -  adv  -  adj`,
    en_raw: `Listen to our folk song, "In Í∑∏ That Faraway Place," how well it is written!`,
    en_split: `Listen  -  to  -  our  -  folk  -  song  -  In  -  that  -  faraway  -  place  -  how  -  well  -  it  -  is  -  written`,
    en_pos: `v  -  prep  -  pron  -  adj  -  n  -  prep  -  det  -  adj  -  n  -  adv  -  adv  -  pron  -  v  -  v`,
    vi: `Th·∫ßy nghe b√†i d√¢n ca c·ªßa ch√∫ng ta k√¨a, "·ªû n∆°i ph∆∞∆°ng xa ·∫•y", vi·∫øt hay bi·∫øt bao!`,
    pinyin: `N«ê tƒ´ng z√°nmen de m√≠ngƒì, "z√†i n√† y√°oyu«én de d√¨fƒÅng", xiƒõ de du≈ç h«éo!`
  }
];
// C·∫≠p nh·∫≠t h√†m render ƒë·ªÉ truy·ªÅn d·ªØ li·ªáu an to√†n h∆°n
function renderBook() {
    const container = document.getElementById('bookContent');
    sentences.forEach((s, i) => {
        const item = document.createElement('div');
        item.className = 'sentence-item';
        item.innerHTML = `
            <div class="text-content">
                <div class="row-cn">
                    <span id="cn-txt-${i}">${s.cn_raw}</span>
                </div>
                <div id="cn-pos-${i}" class="pos-tag hidden">${s.cn_pos}</div>
		<p>
                <div id="pinyin-${i}" class="pinyin-row hidden">${s.pinyin || ''}</div>
                <div class="row-en">
                    <span id="en-txt-${i}">${s.en_raw}</span>
                </div>
                <div id="en-pos-${i}" class="pos-tag hidden">${s.en_pos}</div>
                <p>
                <div class="row-vi">${s.vi}</div>
            </div>
            <div class="control-sidebar">
                <button class="btn-icon" onclick="playSpeech(${i}, 'cn')">üó£Ô∏è</button>
                <button class="btn-icon" onclick="toggleMode(${i}, 'cn')">üß©</button>
                <button class="btn-icon" onclick="playSpeech(${i}, 'en')">üîä</button>
                <button class="btn-icon" onclick="toggleMode(${i}, 'en')">üîç</button>
            </div>
        `;
        container.appendChild(item);
    });
}
// H√†m ph√°t √¢m m·ªõi: L·∫•y d·ªØ li·ªáu tr·ª±c ti·∫øp t·ª´ m·∫£ng thay v√¨ truy·ªÅn chu·ªói qua HTML
// H√†m ph√°t √¢m: T·ª± ƒë·ªông duy tr√¨ ng√¥n ng·ªØ ƒëang ch·ªçn
function playSpeech(index, langType) {
    // 1. D·ª´ng m·ªçi √¢m thanh ƒëang ph√°t ƒë·ªÉ tr√°nh ch·ªìng ch√©o
    window.speechSynthesis.cancel(); 

    let textToRead = "";
    let langCode = "";

    // 2. X√°c ƒë·ªãnh n·ªôi dung v√† m√£ ng√¥n ng·ªØ d·ª±a tr√™n l·ª±a ch·ªçn c·ªßa ng∆∞·ªùi d√πng
    if (langType === 'cn') {
        textToRead = sentences[index].cn_raw;
        langCode = 'zh-CN';
    } else {
        textToRead = sentences[index].en_raw;
        langCode = 'en-US';
    }

    const msg = new SpeechSynthesisUtterance();
    msg.text = textToRead;
    msg.lang = langCode;
    msg.rate = document.getElementById('rate').value;
    
    // 3. Hi·ªáu ·ª©ng Highlight: T√¥ m√†u c√¢u ƒëang ƒë·ªçc ƒë·ªÉ d·ªÖ theo d√µi
    const allItems = document.getElementsByClassName('sentence-item');
    // X√≥a m√†u c·ªßa t·∫•t c·∫£ c√°c c√¢u kh√°c
    Array.from(allItems).forEach(item => item.style.backgroundColor = "transparent");
    // T√¥ m√†u v√†ng nh·∫°t cho c√¢u hi·ªán t·∫°i
    allItems[index].style.backgroundColor = "rgba(230, 126, 34, 0.1)";

    // 4. X·ª≠ l√Ω khi k·∫øt th√∫c c√¢u
    msg.onend = () => {
        const isAuto = document.getElementById('autoNext').checked;
        if (isAuto && index < sentences.length - 1) {
            setTimeout(() => {
                // QUAN TR·ªåNG: Truy·ªÅn ƒë√∫ng langType hi·ªán t·∫°i v√†o l·∫ßn g·ªçi ti·∫øp theo
                playSpeech(index + 1, langType); 
                
                // T·ª± ƒë·ªông cu·ªôn m√†n h√¨nh ƒë·∫øn c√¢u ti·∫øp theo
                allItems[index + 1].scrollIntoView({
                    behavior: "smooth", 
                    block: "center"
                });
            }, 500); // Ngh·ªâ 0.5 gi√¢y gi·ªØa c√°c c√¢u ƒë·ªÉ ng∆∞·ªùi d√πng k·ªãp ng·∫•m
        }
    };

    window.speechSynthesis.speak(msg);
}
function toggleMode(index, lang) {
    const txtSpan = document.getElementById(`${lang}-txt-${index}`);
    const posSpan = document.getElementById(`${lang}-pos-${index}`);
    const isOriginal = txtSpan.innerText === sentences[index][`${lang}_raw`];

    txtSpan.innerText = isOriginal ? sentences[index][`${lang}_split`] : sentences[index][`${lang}_raw`];
    posSpan.classList.toggle('hidden');
}

function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
}

function toggleAllPinyin() {
    // 1. L·∫•y t·∫•t c·∫£ c√°c ph·∫ßn t·ª≠ c√≥ class l√† pinyin-row
    const pinyinElements = document.getElementsByClassName('pinyin-row');
    
    // 2. Ki·ªÉm tra n·∫øu kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ n√†o (b√°o l·ªói ra Console ƒë·ªÉ ki·ªÉm tra)
    if (pinyinElements.length === 0) {
        console.error("Kh√¥ng t√¨m th·∫•y ph·∫ßn t·ª≠ n√†o c√≥ class 'pinyin-row'");
        return;
    }

    // 3. Duy·ªát qua t·ª´ng ph·∫ßn t·ª≠ v√† b·∫≠t/t·∫Øt class 'hidden'
    for (let i = 0; i < pinyinElements.length; i++) {
        pinyinElements[i].classList.toggle('hidden');
    }
}

function speak(text, lang, index) {
    window.speechSynthesis.cancel();
    const msg = new SpeechSynthesisUtterance(text);
    msg.lang = lang;
    msg.rate = document.getElementById('rate').value;

    msg.onend = () => {
        if (document.getElementById('autoNext').checked && index < sentences.length - 1) {
            setTimeout(() => {
                speak(sentences[index + 1].cn_raw, 'zh-CN', index + 1);
                document.getElementsByClassName('sentence-item')[index+1].scrollIntoView({behavior: "smooth", block: "center"});
            }, 1200);
        }
    };
    window.speechSynthesis.speak(msg);
}

renderBook();
</script>
</body>
</html>